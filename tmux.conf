# tmux.conf
# Simon Swanson

####
####

# clear all bindings
unbind -a

# set my prefixes
set -g   prefix C-u
bind C-u send-prefix
bind :   command-prompt

# pane selection
bind -r h selectp -L
bind -r j selectp -D
bind -r k selectp -U
bind -r l selectp -R
bind   \; selectp -l

# window selection
bind -r C-h selectw -p
bind -r C-l selectw -n
bind    `   selectw -l
bind    C-s command-prompt -p "Switch to window number:" "selectw -t '%%'"
bind    1   selectw -t 1
bind    2   selectw -t 2
bind    3   selectw -t 3
bind    4   selectw -t 4
bind    5   selectw -t 5
bind    6   selectw -t 6
bind    7   selectw -t 7
bind    8   selectw -t 8
bind    9   selectw -t 9
bind    0   selectw -t 10

# pane splitting and unsplitting
bind | splitw  -h -c "#{pane_current_path}"
bind - splitw  -v -c "#{pane_current_path}"
bind b breakp
bind w confirm -p    "Close pane #P? (y/n)" killp

# "smart" splitting calibrated for 14 point Menlo font on a 16:10 display - do some math to figure out your numbers
bind m run "[[ $(($(tmux display -p '8*#{pane_width}-18*#{pane_height}'))) -lt 0 ]] && tmux command-prompt -p \"Open large pane with command:\" \"splitw -v -c '#{pane_current_path}' '%%'\" || tmux command-prompt -p \"Open large pane with command:\" \"splitw -h -c '#{pane_current_path}' '%%'\""
bind n run "[[ $(($(tmux display -p '8*#{pane_width}-18*#{pane_height}'))) -lt 0 ]] && tmux splitw -v -c '#{pane_current_path}' || tmux splitw -h -c '#{pane_current_path}'"

# manage windows
bind <   swapw -t -1
bind >   swapw -t +1
bind C-m command-prompt -p "New window with command:" "neww '%%'"
bind C-n neww
bind C-w confirm        -p 'Close window "#W"? (y/n)' killw
bind C-r command-prompt -p 'Rename window "#W":'      "renamew '%%'"

# session management
bind a command-prompt -p "Attach to session:"   "attach -t '%%'"
bind d detach
bind D detach -a
bind R command-prompt -p 'Rename session "#S":' "rename '%%'"

# copy-paste mechanisms that interact with the system clipboard while keeping tmux buffers empty
# requires reattach-to-user-namespace be installed on OS X
bind            o   copy-mode -e
bind            p   run              "reattach-to-user-namespace pbpaste | tmux loadb - && tmux pasteb -d"
bind -t vi-copy v   begin-selection
bind -t vi-copy C-v rectangle-toggle
bind -t vi-copy y   copy-pipe        "reattach-to-user-namespace pbcopy && tmux deleteb"

# avoid copy-mode in alternate screens like vim or less
bind -T root    PPage         if -F      "#{alternate_on}" "send PPage" "copy-mode -e; send PPage"
bind -T root    WheelDownPane if -F -t = "#{alternate_on}" "send -M"    "selectp -t =; copy-mode -e; send -M"
bind -T root    WheelUpPane   if -F -t = "#{alternate_on}" "send -M"    "selectp -t =; copy-mode -e; send -M"
bind -t vi-copy NPage         page-down
bind -t vi-copy PPage         page-up
bind -t vi-copy WheelDownPane scroll-down
bind -t vi-copy WheelUpPane   scroll-up

####
####

# alerts
set  -g bell-action      any
setw -g monitor-activity on
set  -g visual-activity  on

# human indices
set  -g base-index      1
setw -g pane-base-index 1

# general sanity
set -g base-index 1
set -g renumber-windows on
set -g visual-activity on
setw -g aggressive-resize off
setw -g pane-base-index   1

# window title configuration
set -g set-titles        on
set -g set-titles-string 'Yes, Master?'

# basic status bar configuration
set -g message-command-style fg=black,bg=white
set -g message-style         fg=black,bg=white
set -g status                on
set -g status-interval       1
set -g status-justify        left
set -g status-position       bottom
set -g status-style          fg=cyan,bg=brightblack

# left side of status bar configuration
set -g status-left        "[#S] "
set -g status-left-length 40

# set window information in status bar
setw -g window-status-current-style  fg=brightmagenta
setw -g window-status-style          fg=magenta

# right side of status bar configuration
set -g status-right        '"#h"'
set -g status-right-length 60

# terminal modifications
set -g default-terminal "screen-256color"
set -g history-limit    10000

# better interactions with copy-paste shortcuts
set -g buffer-limit 5

# command timeouts
set -sg escape-time 0
set -g  repeat-time 200

# make mouse useful
# needs EasySIMBL and MouseTerm installed on default OS X Terminal
# still doesn't work all the time; very annoying; recommend iTerm2
set -g -q mouse on

# vi > emacs
setw -g mode-keys   vi
set  -g status-keys vi

# allows interaction with system clipboard and applications
set -g default-command    "reattach-to-user-namespace -l bash"
