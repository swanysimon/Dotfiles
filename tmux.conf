# tmux.conf
# Simon Swanson

####
####

# clear all bindings
unbind -a

# set prefixes
set -g   prefix C-u
bind C-u send-prefix
bind :   command-prompt
bind \;  command-prompt

# pane selection
bind -r h selectp -L
bind -r j selectp -D
bind -r k selectp -U
bind -r l selectp -R

# pane resizing
bind -r H resizep -L
bind -r J resizep -D
bind -r K resizep -U
bind -r L resizep -R

# window selection
bind -r C-h prev
bind -r C-l next
bind    1   selectw -t 1
bind    2   selectw -t 2
bind    3   selectw -t 3
bind    4   selectw -t 4
bind    5   selectw -t 5
bind    6   selectw -t 6
bind    7   selectw -t 7
bind    8   selectw -t 8
bind    9   selectw -t 9

# pane splitting
bind | splitw -h -c "#{pane_current_path}"
bind - splitw -v -c "#{pane_current_path}"
bind x confirm -p   "Kill pane #P? (y/n)" killp

# "smart" pane splitting, lowercase opens larger pane, uppercase smaller
# numbers used for 14 point Menlo font on 1280x800 display - estimates each row takes up 20 pixels and each column takes up 8 pixels
bind s run "[[ $(($(tmux display -p '8*#{pane_width}-20*#{pane_height}'))) -lt 0 ]] && tmux splitw -v -c '#{pane_current_path}' || tmux splitw -h -c '#{pane_current_path}'"
bind S run "[[ $(($(tmux display -p '8*#{pane_width}-20*#{pane_height}'))) -lt 0 ]] && tmux splitw -h -c '#{pane_current_path}' || tmux splitw -v -c '#{pane_current_path}'"
bind c run "[[ $(($(tmux display -p '8*#{pane_width}-20*#{pane_height}'))) -lt 0 ]] && tmux command-prompt -p \"Open large pane with command:\" \"splitw -v -c '#{pane_current_path}' '%%'\" || tmux command-prompt -p \"Open large pane with command:\" \"splitw -h -c '#{pane_current_path}' '%%'\""
bind C run "[[ $(($(tmux display -p '8*#{pane_width}-20*#{pane_height}'))) -lt 0 ]] && tmux command-prompt -p \"Open small pane with command:\" \"splitw -h -c '#{pane_current_path}' '%%'\" || tmux command-prompt -p \"Open small pane with command:\" \"splitw -v -c '#{pane_current_path}' '%%'\""
bind x confirm -p "Kill pane #P? (y/n)" killp

# manage windows
bind n neww
bind N breakp
bind m command-prompt -p "New window with command:" "neww '%%'"
bind q confirm        -p 'Kill window "#W"? (y/n)'  killw

# session management
bind a   command-prompt -p "Attach to session:"   "attach -t '%%'"
bind r   command-prompt -p 'Rename session "#S":' "rename '%%'"
bind d   detach
bind C-d detach -a

# copy-paste mechanisms that interact with the system clipboard
# requires reattach-to-user-namespace be installed on OS X
bind            o copy-mode
bind            p run "reattach-to-user-namespace pbpaste | tmux loadb - && tmux pasteb && tmux deleteb"
bind -t vi-copy v begin-selection
bind -t vi-copy y copy-pipe "reattach-to-user-namespace pbcopy && tmux deleteb"

# reload settings
bind R source ~/.tmux.conf \; display "Configuration reloaded"

####
####

# some visual modifications
set  -g set-titles        off
setw -g aggressive-resize on
set  -g visual-activity   on
setw -g monitor-activity  on
set  -g base-index        1   
setw -g pane-base-index   1
set  -g renumber-windows  on

# status bar configuration
set -g status                on
set -g status-position       bottom
set -g status-justify        left
set -g status-style          fg=brightmagenta,bg=brightblack
set -g status-left           "[#S] "
set -g status-left-length    10
set -g status-right          '#[bg=]"#H"'
set -g status-right-length   40
set -g status-interval       1
set -g message-command-style fg=black,bg=white
set -g message-style         fg=black,bg=white

# terminal modifications
set -g default-terminal   "screen-256color"
set -g history-limit      10000
set -g update-environment -r
set -g escape-time        50
set -g repeat-time        250
set -g buffer-limit       1

# make mouse useful
# needs EasySIMBL and MouseTerm installed
# still doesn't work all the time; very annoying
setw -g mode-mouse          on
set  -g mouse-resize-pane   on
set  -g mouse-select-pane   on
set  -g mouse-select-window on

# vi > emacs
setw -g mode-keys   vi
set  -g status-keys vi

# allows interaction with system clipboard and applications
set -g default-command "reattach-to-user-namespace -l bash"
